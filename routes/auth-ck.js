var User=require("../models/User"),helpers=require("../db_helpers");exports.in=function(a,b){var c=typeof a.query.error=="undefined"?!1:!0;b.render("auth/in",{layout:"auth/layout",title:"Authenticate",locals:{error:c}})};exports.allowed=function(a,b){var c=new User;c.username=a.body.username;c.password=a.body.password;c.login(function(c){if(c==null)b.redirect("/auth?error");else{a.session.user={provider:"login",nick:c.username,clearance:c.clearance};b.redirect("/admin")}})};exports.create=function(a,b){var c=typeof a.query.error=="undefined"||a.query.error==""?!1:a.query.error.split(","),d;if(!a.query.user||a.query.user.length===0){d=new User;console.log(new User)}else d=JSON.parse(a.query.user);b.render("auth/create.jade",{layout:"auth/layout.ejs",title:"Sign Up",locals:{error:c,user:d}})};exports.save=function(a,b){try{if(!a.body){console.log("why you signup nobody?");throw new Error("Information did not pass.")}var c=new User;c.username=a.body.nick;c.email=a.body.email;c.fname=a.body.fname;c.lname=a.body.lname;c.password=a.body.p1;c.add(function(d){if(d){var e=helpers.stripErrors(d);e.length==0&&d.code==11e3&&e.push("A user already exists for that username or e-mail");b.redirect("/auth/new?error="+e+"&user="+JSON.stringify(helpers.omitter(c,["password"])))}else{a.session.user={provider:"signup",id:c._id,nick:c.username};a.flash("notice","Welcome!");b.redirect("/auth?success")}})}catch(d){b.redirect("/auth/new?error="+d)}};exports.out=function(a,b){a.session.destroy();b.redirect("/auth")};